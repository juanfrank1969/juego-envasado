<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>El Envasado - App Oficial</title>
    
    <!-- Configuraci√≥n para M√≥vil (PWA) -->
    <meta name="theme-color" content="#f0fdf4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');
        
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f0fdf4;
            overflow: hidden;
            touch-action: manipulation;
        }

        .box-part {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            transform: scale(0.9);
        }
        
        .box-part.visible {
            opacity: 1;
            transform: scale(1);
        }

        .cardboard {
            background-color: #d4a373;
            border: 2px solid #9c6644;
            position: absolute;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.1);
        }

        .game-char {
            transition: transform 0.3s;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }

        .level-badge {
            background: linear-gradient(135deg, #166534 0%, #15803d 100%);
        }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center p-4">

    <!-- Encabezado de Estad√≠sticas -->
    <div class="w-full max-w-md flex flex-col gap-2 mb-4">
        <div class="flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="level-badge text-white px-3 py-1 rounded-xl text-center">
                    <p class="text-[8px] uppercase font-bold opacity-80">Nivel</p>
                    <p id="level-display" class="text-lg font-bold leading-none">1</p>
                </div>
                <h1 class="text-xl font-bold text-green-800">üì¶ ENVASADO</h1>
            </div>
            <div class="text-right">
                <p class="text-[10px] text-gray-500 font-bold uppercase">Puntos</p>
                <p id="score-display" class="text-xl font-bold text-green-600">0</p>
            </div>
        </div>
        <!-- Barra de Progreso -->
        <div class="w-full bg-green-200 h-2 rounded-full overflow-hidden">
            <div id="progress-bar" class="h-full bg-green-600 transition-all duration-500" style="width: 0%"></div>
        </div>
    </div>

    <!-- √Årea de la Caja -->
    <div class="relative w-64 h-64 bg-white rounded-3xl shadow-2xl flex items-center justify-center overflow-hidden border-2 border-green-100">
        <div id="character" class="text-7xl md:text-8xl z-10 game-char">üò∞</div>

        <!-- Partes de la Caja -->
        <div id="p1" class="box-part cardboard w-full bottom-0 h-1/6 z-0"></div>
        <div id="p2" class="box-part cardboard w-full h-full bottom-0 bg-[#ccb7a3] z-0"></div>
        <div id="p3" class="box-part cardboard h-full left-0 w-1/6 z-20"></div>
        <div id="p4" class="box-part cardboard h-full right-0 w-1/6 z-20"></div>
        <div id="p5" class="box-part cardboard w-full bottom-0 h-4/6 z-30 opacity-90"></div>
        <div id="p6" class="box-part cardboard w-full h-full top-0 z-40 flex items-center justify-center bg-[#8d5c3d]">
            <span class="text-white font-bold border-2 p-1 rounded text-xs">SELLADO</span>
        </div>
    </div>

    <!-- Interfaz de Juego -->
    <div class="mt-6 w-full max-w-sm text-center">
        <div id="cat" class="text-[10px] font-bold text-green-700 bg-green-100 px-3 py-1 rounded-full mb-3 inline-block uppercase tracking-tighter italic">Pista: ...</div>
        
        <div id="word-display" class="flex justify-center gap-1 mb-6 text-3xl font-bold text-green-900 tracking-widest min-h-[40px]"></div>

        <div id="keyboard" class="grid grid-cols-7 gap-1 mb-4"></div>
        
        <button id="next-btn" onclick="initGame()" class="hidden w-full bg-green-600 text-white py-4 rounded-2xl font-bold shadow-lg uppercase transition-all active:scale-95">Siguiente Palabra</button>
        <button id="reset-btn" onclick="resetAll()" class="hidden w-full bg-red-500 text-white py-4 rounded-2xl font-bold shadow-lg uppercase">Reiniciar Juego</button>
    </div>

    <script>
        // --- SONIDOS ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, type, dur) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type; osc.frequency.value = freq;
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + dur);
        }

        // --- DATOS Y LOGICA ---
        const levels = {
            1: { words: ["CASA", "PERRO", "SOL", "MESA"], cat: "B√°sico" },
            2: { words: ["GUITARRA", "COLEGIO", "PL√ÅTANO", "ESPEJO"], cat: "Intermedio" },
            3: { words: ["ASTRONAUTA", "BIBLIOTECA", "HELIC√ìPTERO"], cat: "Avanzado" }
        };

        let currentLevel = 1, score = 0, solvedInLevel = 0;
        let secret, letters, fails, isOver = false;

        function initGame() {
            const levelData = levels[currentLevel] || levels[3];
            const wordList = levelData.words;
            secret = wordList[Math.floor(Math.random() * wordList.length)];
            
            document.getElementById('cat').textContent = "Pista: " + levelData.cat;
            document.getElementById('level-display').textContent = currentLevel;
            document.getElementById('next-btn').classList.add('hidden');
            document.getElementById('reset-btn').classList.add('hidden');
            document.getElementById('character').textContent = "üò∞";
            
            letters = []; fails = 0; isOver = false;
            for(let i=1; i<=6; i++) {
                const p = document.getElementById('p'+i);
                p.classList.remove('visible');
            }
            render(); renderKeys();
        }

        function render() {
            const display = secret.split('').map(l => letters.includes(l) ? l : "_").join(" ");
            document.getElementById('word-display').textContent = display;
            if(!display.includes("_") && !isOver) handleWin();
        }

        function renderKeys() {
            const kb = document.getElementById('keyboard');
            kb.innerHTML = '';
            "ABCDEFGHIJKLMN√ëOPQRSTUVWXYZ".split('').forEach(l => {
                const btn = document.createElement('button');
                btn.textContent = l;
                btn.className = "bg-white p-2 rounded shadow-sm font-bold text-green-700 text-sm disabled:opacity-20 transition-all active:bg-green-100";
                btn.disabled = letters.includes(l) || isOver;
                btn.onclick = () => {
                    letters.push(l);
                    if(!secret.includes(l)) {
                        fails++;
                        playSound(150, 'sawtooth', 0.2);
                        document.getElementById('p'+fails).classList.add('visible');
                        if(fails >= 6) handleLoss();
                    } else {
                        playSound(600, 'sine', 0.1);
                    }
                    render(); renderKeys();
                };
                kb.appendChild(btn);
            });
        }

        function handleWin() {
            isOver = true;
            score += (currentLevel * 50);
            solvedInLevel++;
            document.getElementById('score-display').textContent = score;
            document.getElementById('character').textContent = "üòé";
            
            if(solvedInLevel >= 2) {
                currentLevel++;
                solvedInLevel = 0;
            }
            
            document.getElementById('progress-bar').style.width = (solvedInLevel * 50) + "%";
            document.getElementById('next-btn').classList.remove('hidden');
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.8 } });
            playSound(800, 'sine', 0.3);
        }

        function handleLoss() {
            isOver = true;
            document.getElementById('character').textContent = "üì¶";
            document.getElementById('word-display').textContent = secret;
            document.getElementById('word-display').classList.add('text-red-600');
            document.getElementById('reset-btn').classList.remove('hidden');
            playSound(100, 'sawtooth', 0.5);
        }

        function resetAll() {
            currentLevel = 1; score = 0; solvedInLevel = 0;
            document.getElementById('score-display').textContent = "0";
            document.getElementById('progress-bar').style.width = "0%";
            document.getElementById('word-display').classList.remove('text-red-600');
            initGame();
        }

        initGame();
    </script>
</body>
</html>

