<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>El Envasado</title>
    
    <!-- ConfiguraciÃ³n MÃ³vil -->
    <meta name="theme-color" content="#f0fdf4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Envasado">
    <link rel="apple-touch-icon" href="https://em-content.zobj.net/source/apple/354/package_1f4e6.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        body { background-color: #f0fdf4; font-family: ui-sans-serif, system-ui, sans-serif; overflow: hidden; touch-action: manipulation; }
        .box-part { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); opacity: 0; transform: translateY(20px); pointer-events: none; }
        .box-part.visible { opacity: 1; transform: translateY(0); }
        .cardboard { background-color: #d4a373; border: 2px solid #9c6644; position: absolute; }
        .key-btn { transition: all 0.1s; }
        .key-btn:active { transform: scale(0.9); background-color: #dcfce7; }
        #character { transition: all 0.5s ease; }
        /* Ajuste para evitar efecto de corte en el emoji */
        .char-container { display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; position: relative; z-index: 10; }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-between p-6 pb-12">

    <!-- Marcador -->
    <div class="text-center">
        <h1 class="text-3xl font-black text-green-800 tracking-tighter">ðŸ“¦ EL ENVASADO</h1>
        <div class="bg-white px-4 py-1 rounded-full shadow-sm inline-block mt-2 border border-green-100">
            <span class="text-sm font-bold text-green-600 uppercase">Puntos: <span id="score">0</span></span>
        </div>
    </div>

    <!-- Contenedor de la Caja -->
    <div class="relative w-64 h-64 bg-white rounded-[2.5rem] shadow-2xl overflow-hidden border-8 border-green-50">
        <!-- Contenedor del personaje para evitar cortes visuales -->
        <div class="char-container">
            <div id="character" class="text-8xl">ðŸ˜°</div>
        </div>
        
        <!-- Partes de la caja que cubren al personaje -->
        <div id="p1" class="box-part cardboard w-full bottom-0 h-1/5 z-20"></div>
        <div id="p2" class="box-part cardboard w-full h-full bottom-0 bg-[#ccb7a3] z-10"></div>
        <div id="p3" class="box-part cardboard h-full left-0 w-1/5 z-30"></div>
        <div id="p4" class="box-part cardboard h-full right-0 w-1/5 z-30"></div>
        <div id="p5" class="box-part cardboard w-full bottom-0 h-3/5 z-40 opacity-95"></div>
        <div id="p6" class="box-part cardboard w-full h-full top-0 z-50 flex items-center justify-center bg-[#8d5c3d]">
            <div class="border-4 border-white/30 p-2 rounded-lg text-white font-black uppercase tracking-widest">Listo</div>
        </div>
    </div>

    <!-- Interfaz -->
    <div class="w-full max-w-sm text-center">
        <div id="cat" class="text-[10px] font-black text-green-700 bg-green-100 px-4 py-1 rounded-full mb-4 inline-block uppercase tracking-widest">Cargando...</div>
        <div id="word" class="flex justify-center gap-2 mb-8 text-3xl font-mono font-bold text-green-900 min-h-[40px]"></div>
        
        <div id="keyboard" class="grid grid-cols-7 gap-1.5 md:gap-2"></div>
        
        <button id="next-btn" onclick="init()" class="hidden mt-8 bg-green-600 text-white w-full py-4 rounded-2xl font-black shadow-lg uppercase">Siguiente</button>
    </div>

    <script>
        // Service Worker silencioso para habilitar instalaciÃ³n PWA
        if ('serviceWorker' in navigator) {
            const sw = 'self.addEventListener("fetch", (e) => {});';
            const blob = new Blob([sw], {type: 'text/javascript'});
            navigator.serviceWorker.register(URL.createObjectURL(blob)).catch(()=>{});
        }

        const words = [
            {w: "MANZANA", c: "FRUTA"}, {w: "GUITARRA", c: "MUSICA"}, {w: "ELEFANTE", c: "ANIMAL"},
            {w: "COLOMBIA", c: "PAIS"}, {w: "TIBURON", c: "MAR"}, {w: "PLANETA", c: "ESPACIO"}
        ];

        let secret, letters, fails, score = 0;

        function init() {
            const item = words[Math.floor(Math.random() * words.length)];
            secret = item.w;
            document.getElementById('cat').textContent = item.c;
            letters = []; fails = 0;
            document.getElementById('next-btn').classList.add('hidden');
            document.getElementById('character').textContent = "ðŸ˜°";
            // Reiniciar visibilidad de las partes de la caja
            for(let i=1; i<=6; i++) document.getElementById('p'+i).classList.remove('visible');
            render(); renderKeys();
        }

        function render() {
            const display = secret.split('').map(l => letters.includes(l) ? l : "_").join(" ");
            document.getElementById('word').textContent = display;
            if(!display.includes("_")) win();
        }

        function renderKeys() {
            const kb = document.getElementById('keyboard');
            kb.innerHTML = '';
            "ABCDEFGHIJKLMNÃ‘OPQRSTUVWXYZ".split('').forEach(l => {
                const btn = document.createElement('button');
                btn.textContent = l;
                btn.className = "key-btn bg-white py-3 rounded-lg shadow-sm font-bold text-green-800 text-sm disabled:opacity-20";
                btn.disabled = letters.includes(l) || fails >= 6;
                btn.onclick = () => {
                    letters.push(l);
                    if(!secret.includes(l)) {
                        fails++;
                        document.getElementById('p'+fails).classList.add('visible');
                        if(fails >= 6) lose();
                    }
                    render(); renderKeys();
                };
                kb.appendChild(btn);
            });
        }

        function win() {
            score += 100;
            document.getElementById('score').textContent = score;
            document.getElementById('character').textContent = "ðŸ˜Ž";
            document.getElementById('next-btn').classList.remove('hidden');
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.8 } });
        }

        function lose() {
            document.getElementById('character').textContent = "ðŸ“¦";
            document.getElementById('word').textContent = secret;
            document.getElementById('next-btn').classList.remove('hidden');
            document.getElementById('next-btn').textContent = "REINTENTAR";
        }

        // Arrancar juego
        init();
    </script>
</body>
</html>


